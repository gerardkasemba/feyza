"use strict";(()=>{var e={};e.id=1778,e.ids=[1778],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},28191:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>d,POST:()=>p});var n=r(49303),a=r(88716),o=r(60670),i=r(87070),u=r(65655),c=r(71615);async function l(){let e=await (0,c.cookies)(),t=e.get("agent_id")?.value,r=e.get("agent_token")?.value;if(!t||!r)return null;let s=await (0,u.k)(),{data:n}=await s.from("agents").select("*").eq("id",t).eq("is_active",!0).single();return n}async function d(e){try{let t=await l();if(!t)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=await (0,u.k)(),{searchParams:s}=new URL(e.url),n=s.get("status"),a=s.get("country"),o=s.get("method"),c=r.from("disbursements").select(`
        *,
        loan:loans(
          id,
          amount,
          currency,
          borrower:users!borrower_id(id, email, full_name, phone)
        )
      `).order("created_at",{ascending:!1});"admin"!==t.role&&t.country&&(c=c.eq("recipient_country",t.country)),n&&(c=c.eq("status",n)),a&&(c=c.eq("recipient_country",a)),o&&(c=c.eq("disbursement_method",o));let{data:d,error:p}=await c;if(p)return console.error("Error fetching disbursements:",p),i.NextResponse.json({error:"Failed to fetch disbursements"},{status:500});let{data:m}=await r.from("disbursements").select("status").eq("admin"!==t.role&&t.country?"recipient_country":"id","admin"!==t.role&&t.country?t.country:d?.map(e=>e.id)||[]),g={pending:0,processing:0,ready_for_pickup:0,completed:0,failed:0};return d?.forEach(e=>{g.hasOwnProperty(e.status)&&g[e.status]++}),i.NextResponse.json({disbursements:d,stats:g,total:d?.length||0})}catch(e){return console.error("Error in disbursements GET:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e){try{await l();let t=await (0,u.k)(),{loan_id:r,amount:s,currency:n,disbursement_method:a,mobile_provider:o,mobile_number:c,mobile_name:d,bank_name:p,bank_account_name:m,bank_account_number:g,bank_branch:x,bank_swift_code:y,pickup_location:h,recipient_name:f,recipient_phone:b,recipient_id_type:v,recipient_id_number:j,recipient_country:E}=await e.json();if(!r||!s||!a||!f)return i.NextResponse.json({error:"Missing required fields"},{status:400});let{data:w,error:I}=await t.from("disbursements").insert({loan_id:r,amount:s,currency:n||"USD",disbursement_method:a,mobile_provider:o,mobile_number:c,mobile_name:d,bank_name:p,bank_account_name:m,bank_account_number:g,bank_branch:x,bank_swift_code:y,pickup_location:h,recipient_name:f,recipient_phone:b,recipient_id_type:v,recipient_id_number:j,recipient_country:E,status:"pending"}).select().single();if(I)return console.error("Error creating disbursement:",I),i.NextResponse.json({error:"Failed to create disbursement"},{status:500});return i.NextResponse.json({success:!0,disbursement:w})}catch(e){return console.error("Error in disbursements POST:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/agent/disbursements/route",pathname:"/api/agent/disbursements",filename:"route",bundlePath:"app/api/agent/disbursements/route"},resolvedPagePath:"C:\\Users\\GerardKasemba\\feyza\\src\\app\\api\\agent\\disbursements\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:y}=m,h="/api/agent/disbursements/route";function f(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:x})}},65655:(e,t,r)=>{r.d(t,{f:()=>a,k:()=>o});var s=r(67721),n=r(71615);async function a(){let e=await (0,n.cookies)();return(0,s.createServerClient)("https://mregojhoivbxdvgjrixz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1yZWdvamhvaXZieGR2Z2pyaXh6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1ODE1NDQsImV4cCI6MjA4MzE1NzU0NH0.I_jEMf00cFYAdF0akvD-HOqXWExxO3E0BV69EHEa5jI",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>e.set(t,r,s))}catch{}}}})}async function o(){let e=await (0,n.cookies)();return(0,s.createServerClient)("https://mregojhoivbxdvgjrixz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>e.set(t,r,s))}catch{}}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,3786,9702,5972],()=>r(28191));module.exports=s})();